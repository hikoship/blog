<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta name="generator" content="Hugo 0.151.2" />

<meta name="keywords" content="the great garage, hiko, hikoship, blog">
<meta name="description" content="">
<meta name="author" content="hiko, hikoship">


<meta name="viewport" content="width=device-width, initial-scale=1">


<link href='https://fonts.googleapis.com/css?family=Lato:100,300,400,600' rel='stylesheet' type='text/css'>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css">
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/pygments.css">


<link rel="icon" type="image/png" href="images/favicon.png">




<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-55878990-3', 'auto');
    ga('send', 'pageview');

 </script>


<title>An Optimization of QMK Mod-tap (Layer-tap) for Fast Typists - The Great Garage</title>

    </head>
    <body>
        <div class="container">
            <header align="center" class="nav">
    <div id="top-bar"></div>
    <a href="/"><img id="img-title" src="/images/logo.png" alt="The Great Garage - Logo" /></a>
    <div class="row">
        <div class="twelve columns" style="margin-top: 0">
            <a href="/post">Posts</a><span class="divider"> ✢ </span>
            <a href="/categories">Categories</a><span class="divider"> ✢ </span>
            <a href="/collection">Collection</a><span class="divider"> ✢ </span>
            <a href="/about">About</a>
            
        </div>
    </div>
</header>

            <main role="main">
                <article>
                    <header class="meta" align="center">
                        <h2>An Optimization of QMK Mod-tap (Layer-tap) for Fast Typists</h2>
                    </header>
                    <div class="content">
                        <p><strong>The code doesn&rsquo; work as expected. Please refer to <code>IGNORE_MOD_TAP_INTERRUPT</code> and <code>PERMISSIVE_HOLD</code> <a href="https://github.com/qmk/qmk_firmware/blob/master/docs/config_options.md">here</a> for possible workarounds.</strong></p>
<p><a href="http://qmk.fm">QMK</a> is the most powerful and popular keyboard firmware in custimzed mechanical keyboard community. It allows you to can write C code to set macros to any key, which makes it highly playable.</p>
<p>Apart from programming, QMK has quite a lot of pre-set quantum keys. An important category of them is mod-tap keys. That means, when you tap the key, it prints a normal output, such as a letter, digit or any other key on the keyboard; when you hold it, it works like a mod key, such as Control, Alt, Shift or Win (Command/Super). That&rsquo;s particually useful for mini keyboards (40% layout, for example), where keys are highly reused.</p>
<p>However, the performance of mod-tap may not meet the need of fast typing. For example, if the mod-tap key is Control(A), and you press Control(A) and C fast, it actually prints &ldquo;AC&rdquo; on the screen, but not sends a Control + C combination. The same thing happens on layer-tap key.</p>
<p>I haven&rsquo;t read the source code of mod-tap keys, but with programming, we can avoid this issue completely.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="cp">#include</span> <span class="cpf">QMK_KEYBOARD_H</span><span class="cp">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kt">bool</span> <span class="n">lctl_other_key_pressed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="kt">uint16_t</span> <span class="n">lctl_hold_timer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="kt">bool</span> <span class="nf">process_record_user</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">keycode</span><span class="p">,</span> <span class="kt">keyrecord_t</span> <span class="o">*</span><span class="n">record</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">switch</span> <span class="p">(</span><span class="n">keycode</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="c1">// Left control. Can be changed to any modifier, or MO({LAYER_NUM}) for layer-taps.
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>    <span class="k">case</span> <span class="nl">KC_LCTL</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">record</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">pressed</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="c1">// Records press time.
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span>		<span class="n">lctl_hold_timer</span> <span class="o">=</span> <span class="nf">timer_read</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="c1">// At the beginning, no other key is pressed.
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span>		<span class="n">lctl_other_key_pressed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nf">timer_elapsed</span><span class="p">(</span><span class="n">lctl_timer</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">500</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">space_other_key_pressed</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="c1">// Sends out &#39;A&#39; if the key is held for less than 0.5s and no other key was pressed during the period. 
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1"></span>		<span class="nf">tap_code</span><span class="p">(</span><span class="n">KC_A</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">	  <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">	<span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">      <span class="c1">// Another key is pressed.
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="c1"></span>      <span class="n">lctl_other_key_pressed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">};</span></span></span></code></pre></div>
<p>In this piece of code, we set the keycode of the mod-tap key to a normal Control key. It ensures it works perfectly as a mod key. Then we attach another event to this key when it is released - we sends a normal letter, which is the &ldquo;tap&rdquo; part of mod-tap. Tap is only triggerred when the key was held shortly and no other key is pressed before release. This way, even fast typists can enjoy mod-tap keys happily.</p>
<p>I&rsquo;m not sure if the current behavior of mod-tap is expected by QMK developer, but I will do some investigation on it and see if I can make the solution general to the default mod-tap implementation.</p>

                    </div>
                </article>
                
<hr>
<div id="disqus_thread"></div>
<script type="text/javascript">
     
    var disqus_shortname = 'gaohongyuan';

     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

            </main>
        </div>
        <footer class="footer">
	<div align="center">
		Favs・
		<a href="http://gaocegege.com/Blog/">高策</a> | 
		<a href="https://dlyang.me/">LanternD</a> | 
		<a href="https://www.lattespirit.com/">Lattespirit</a> | 
		<a href="http://blog.ikow.cn/">kow</a><br>
		<br>
		&copy; 2015 - 2019 <a href="http://hgao.net">HiKo</a><br>
		Powered by <a href="http://gohugo.io/">Hugo</a> ・ Hosted on <a href="https://m.do.co/c/a383f1ca8bde">DigitalOcean</a>
	</div>
</footer>

    </body>
</html>
